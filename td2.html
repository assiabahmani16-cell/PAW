<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Tutorial 2 — Exercises 1–4 Solution</title>
    <style>
      body {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
        background: #f6f7fb;
        color: #111;
        margin: 20px;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        max-width: 1200px;
        margin-bottom: 16px;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 6px 8px;
        text-align: center;
        font-size: 14px;
      }
      th {
        background: #222;
        color: #fff;
        font-weight: 600;
      }
      thead th.sticky {
        position: sticky;
        top: 0;
        z-index: 2;
      }
      .controls {
        display: flex;
        gap: 12px;
        align-items: flex-end;
        margin-bottom: 12px;
      }
      form {
        background: #fff;
        padding: 12px;
        border-radius: 8px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
        max-width: 760px;
      }
      label {
        display: block;
        margin-bottom: 4px;
        font-size: 13px;
      }
      input[type="text"],
      input[type="email"] {
        width: 100%;
        padding: 6px;
        border: 1px solid #cfcfcf;
        border-radius: 4px;
      }
      .col {
        flex: 1;
      }
      .row {
        display: flex;
        gap: 12px;
      }
      .errors {
        color: #b00020;
        font-size: 13px;
        margin-top: 6px;
      }
      .msg {
        padding: 8px;
        border-radius: 6px;
        background: #e9f7ef;
        color: #064e2f;
        display: inline-block;
        margin-left: 8px;
      }
      .highlight-green {
        background: #e6f9e9;
      }
      .highlight-yellow {
        background: #fff7d6;
      }
      .highlight-red {
        background: #ffe6e6;
      }
      button {
        padding: 8px 12px;
        border-radius: 6px;
        border: 0;
        background: #0b63d4;
        color: #fff;
        cursor: pointer;
      }
      .small {
        font-size: 13px;
        padding: 6px 8px;
      }
      .confirmation {
        color: #064e2f;
        margin-left: 10px;
      }
      #report {
        background: #fff;
        padding: 16px;
        border-radius: 8px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
        margin-top: 24px;
        max-width: 700px;
      }
      #report h2 {
        margin-top: 0;
      }
      canvas {
        max-width: 100%;
      }
    </style>
  </head>
  <body>
      <h1>Attendance Table (S1 - S6 and P1 - P6)</h1>

      <div class="controls">
          <form id="addStudentForm">
              <div class="row">
                  <div class="col">
                      <label>Student ID</label>
                      <input type="text" id="studentId" />
                      <div id="errId" class="errors" aria-live="polite"></div>
                  </div>
                  <div class="col">
                      <label>Last Name</label>
                      <input type="text" id="lastName" />
                      <div id="errLast" class="errors" aria-live="polite"></div>
                  </div>
                  <div class="col">
                      <label>First Name</label>
                      <input type="text" id="firstName" />
                      <div id="errFirst" class="errors" aria-live="polite"></div>
                  </div>
                  <div class="col">
                      <label>Email</label>
                      <input type="email" id="email" />
                      <div id="errEmail" class="errors" aria-live="polite"></div>
                  </div>
                  <div style="min-width: 140px">
                      <label>&nbsp;</label>
                      <button type="submit" id="submitBtn">Add Student</button>
                  </div>
              </div>
          </form>
          <div id="confirmBox" class="confirmation" aria-live="polite"></div>
      </div>

      <table id="attendanceTable">
          <thead>
              <tr>
                  <th class="sticky">Student ID</th>
                  <th class="sticky">Last Name</th>
                  <th class="sticky">First Name</th>
                  <th colspan="6">S1 S2 S3 S4 S5 S6</th>
                  <th colspan="6">P1 P2 P3 P4 P5 P6</th>
                  <th class="sticky">Absences</th>
                  <th class="sticky">Participation</th>
                  <th class="sticky">Message</th>
              </tr>
              <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>S1</th>
                  <th>S2</th>
                  <th>S3</th>
                  <th>S4</th>
                  <th>S5</th>
                  <th>S6</th>
                  <th>P1</th>
                  <th>P2</th>
                  <th>P3</th>
                  <th>P4</th>
                  <th>P5</th>
                  <th>P6</th>
                  <th></th>
                  <th></th>
                  <th></th>
              </tr>
          </thead>
          <tbody>
              <tr>
                  <td>1001</td>
                  <td>Ahmed</td>
                  <td>Sara</td>
                  <td><input type="checkbox" class="sess" /></td>
                  <td><input type="checkbox" class="sess" checked /></td>
                  <td><input type="checkbox" class="sess" checked /></td>
                  <td><input type="checkbox" class="sess" /></td>
                  <td><input type="checkbox" class="sess" checked /></td>
                  <td><input type="checkbox" class="sess" /></td>
                  <td><input type="checkbox" class="part" /></td>
                  <td><input type="checkbox" class="part" checked /></td>
                  <td><input type="checkbox" class="part" /></td>
                  <td><input type="checkbox" class="part" /></td>
                  <td><input type="checkbox" class="part" checked /></td>
                  <td><input type="checkbox" class="part" /></td>
                  <td class="abs">0</td>
                  <td class="par">0</td>
                  <td class="msgcol"></td>
              </tr>
              <tr>
                  <td>1002</td>
                  <td>Yacine</td>
                  <td>Ali</td>
                  <td><input type="checkbox" class="sess" checked /></td>
                  <td><input type="checkbox" class="sess" /></td>
                  <td><input type="checkbox" class="sess" checked /></td>
                  <td><input type="checkbox" class="sess" checked /></td>
                  <td><input type="checkbox" class="sess" checked /></td>
                  <td><input type="checkbox" class="sess" checked /></td>
                  <td><input type="checkbox" class="part" checked /></td>
                  <td><input type="checkbox" class="part" checked /></td>
                  <td><input type="checkbox" class="part" /></td>
                  <td><input type="checkbox" class="part" checked /></td>
                  <td><input type="checkbox" class="part" checked /></td>
                  <td><input type="checkbox" class="part" checked /></td>
                  <td class="abs">0</td>
                  <td class="par">0</td>
                  <td class="msgcol"></td>
              </tr>
              <tr>
                  <td>1003</td>
                  <td>Houcine</td>
                  <td>Rania</td>
                  <td><input type="checkbox" class="sess" checked /></td>
                  <td><input type="checkbox" class="sess" checked /></td>
                  <td><input type="checkbox" class="sess" /></td>
                  <td><input type="checkbox" class="sess" checked /></td>
                  <td><input type="checkbox" class="sess" checked /></td>
                  <td><input type="checkbox" class="sess" /></td>
                  <td><input type="checkbox" class="part" checked /></td>
                  <td><input type="checkbox" class="part" /></td>
                  <td><input type="checkbox" class="part" /></td>
                  <td><input type="checkbox" class="part" checked /></td>
                  <td><input type="checkbox" class="part" /></td>
                  <td><input type="checkbox" class="part" /></td>
                  <td class="abs">0</td>
                  <td class="par">0</td>
                  <td class="msgcol"></td>
              </tr>
          </tbody>
      </table>

      <div id="report">
          <h2>Attendance Summary Report</h2>
          <button id="generateReport" class="small">Generate Report</button>
          <div id="reportText"></div>
          <canvas id="chartCanvas" height="150"></canvas>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script>
          const table = document.getElementById("attendanceTable");
          const tbody = table.tBodies[0];

          function updateAll() {
              Array.from(tbody.rows).forEach(updateRow);
          }

          function updateRow(row) {
              const sess = row.querySelectorAll(".sess");
              const part = row.querySelectorAll(".part");
              let presentCount = 0;
              sess.forEach((cb) => {
                  if (cb.checked) presentCount++;
              });
              const absences = sess.length - presentCount;
              let partCount = 0;
              part.forEach((cb) => {
                  if (cb.checked) partCount++;
              });

              row.querySelector(".abs").textContent = absences;
              row.querySelector(".par").textContent = partCount;

              row.classList.remove(
                  "highlight-green",
                  "highlight-yellow",
                  "highlight-red"
              );
              if (absences < 3) row.classList.add("highlight-green");
              else if (absences <= 4) row.classList.add("highlight-yellow");
              else row.classList.add("highlight-red");

              const msgCell = row.querySelector(".msgcol");
              let message = "";
              if (absences >= 5)
                  message =
                      "Excluded — too many absences — You need to participate more";
              else if (absences >= 3) {
                  if (partCount >= 3)
                      message = "Warning — attendance low — Participation OK";
                  else
                      message = "Warning — attendance low — You need to participate more";
              } else {
                  if (partCount >= 3)
                      message = "Good attendance — Excellent participation";
                  else message = "Good attendance — You should participate more";
              }
              msgCell.textContent = message;
          }

          function bindCheckboxListeners(container) {
              container.querySelectorAll("input[type=checkbox]").forEach((cb) => {
                  cb.addEventListener("change", () => {
                      updateAll();
                  });
              });
          }

          bindCheckboxListeners(table);
          updateAll();

          const form = document.getElementById("addStudentForm");
          const studentId = document.getElementById("studentId");
          const lastName = document.getElementById("lastName");
          const firstName = document.getElementById("firstName");
          const email = document.getElementById("email");

          const errId = document.getElementById("errId");
          const errLast = document.getElementById("errLast");
          const errFirst = document.getElementById("errFirst");
          const errEmail = document.getElementById("errEmail");
          const confirmBox = document.getElementById("confirmBox");

          function validate() {
              let ok = true;
              errId.textContent =
                  errLast.textContent =
                  errFirst.textContent =
                  errEmail.textContent =
                  "";

              if (!studentId.value.trim()) {
                  errId.textContent = "Student ID is required";
                  ok = false;
              } else if (!/^\d+$/.test(studentId.value.trim())) {
                  errId.textContent = "Student ID must contain only numbers";
                  ok = false;
              }

              if (!lastName.value.trim()) {
                  errLast.textContent = "Last name is required";
                  ok = false;
              } else if (!/^[A-Za-zÀ-ÖØ-öø-ÿ \-']+$/.test(lastName.value.trim())) {
                  errLast.textContent = "Last name must contain only letters";
                  ok = false;
              }

              if (!firstName.value.trim()) {
                  errFirst.textContent = "First name is required";
                  ok = false;
              } else if (!/^[A-Za-zÀ-ÖØ-öø-ÿ \-']+$/.test(firstName.value.trim())) {
                  errFirst.textContent = "First name must contain only letters";
                  ok = false;
              }

              if (!email.value.trim()) {
                  errEmail.textContent = "Email is required";
                  ok = false;
              } else if (!/^\S+@\S+\.\S+$/.test(email.value.trim())) {
                  errEmail.textContent = "Email format invalid";
                  ok = false;
              }

              return ok;
          }

          form.addEventListener("submit", (e) => {
              e.preventDefault();
              confirmBox.textContent = "";
              if (!validate()) return;

              const row = tbody.insertRow();
              function insertCell(text) {
                  const c = row.insertCell();
                  if (text !== undefined) c.textContent = text;
                  return c;
              }
              insertCell(studentId.value.trim());
              insertCell(lastName.value.trim());
              insertCell(firstName.value.trim());

              for (let i = 0; i < 6; i++) {
                  const c = row.insertCell();
                  const cb = document.createElement("input");
                  cb.type = "checkbox";
                  cb.className = "sess";
                  c.appendChild(cb);
              }
              for (let i = 0; i < 6; i++) {
                  const c = row.insertCell();
                  const cb = document.createElement("input");
                  cb.type = "checkbox";
                  cb.className = "part";
                  c.appendChild(cb);
              }
              insertCell().className = "abs";
              insertCell().className = "par";
              insertCell().className = "msgcol";

              bindCheckboxListeners(row);
              updateRow(row);

              confirmBox.textContent = `Student ${lastName.value.trim()} ${firstName.value.trim()} added.`;
              studentId.value = lastName.value = firstName.value = email.value = "";
          });

          table.addEventListener("keydown", (e) => {
              if (
                  e.key === "Enter" &&
                  e.target instanceof HTMLInputElement &&
                  e.target.type === "checkbox"
              ) {
                  e.preventDefault();
                  e.target.checked = !e.target.checked;
                  updateAll();
              }
          });

          // EXERCISE 4 — REPORT GENERATION
          const reportBtn = document.getElementById("generateReport");
          const reportText = document.getElementById("reportText");
          const ctx = document.getElementById("chartCanvas").getContext("2d");
          let chart;

          reportBtn.addEventListener("click", () => {
              updateAll();
              let total = tbody.rows.length;
              let lowAbs = 0,
                  midAbs = 0,
                  highAbs = 0;
              Array.from(tbody.rows).forEach((r) => {
                  const abs = parseInt(r.querySelector(".abs").textContent);
                  if (abs < 3) lowAbs++;
                  else if (abs <= 4) midAbs++;
                  else highAbs++;
              });
              const avgAbs = (
                  Array.from(tbody.rows).reduce(
                      (sum, r) => sum + parseInt(r.querySelector(".abs").textContent),
                      0
                  ) / total
              ).toFixed(2);
              reportText.innerHTML = `<p><strong>Total Students:</strong> ${total}</p>
                                                                        <p><strong>Average Absences:</strong> ${avgAbs}</p>
                                                                        <p><strong>Green (&lt;3 abs):</strong> ${lowAbs}, <strong>Yellow (3–4):</strong> ${midAbs}, <strong>Red (≥5):</strong> ${highAbs}</p>`;

              const data = {
                  labels: ["<3 abs", "3–4 abs", "≥5 abs"],
                  datasets: [
                      {
                          label: "Absence Distribution",
                          data: [lowAbs, midAbs, highAbs],
                          backgroundColor: ["#9be8a9", "#fff799", "#ff9999"],
                      },
                  ],
              };
              if (chart) chart.destroy();
              chart = new Chart(ctx, {
                  type: "bar",
                  data,
                  options: {
                      responsive: true,
                      plugins: {
                          legend: { display: false },
                          title: { display: true, text: "Attendance Overview" },
                      },
                  },
              });
          });
      </script>
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

      <script>
          $(document).ready(function () {

              const $table = $("#attendanceTable");
              const $tbody = $table.find("tbody");


              function updateRow($row) {
                  const $sess = $row.find(".sess");
                  const $part = $row.find(".part");

                  let absences = 0;
                  $sess.each(function () { if (!$(this).prop("checked")) absences++; });

                  let participation = 0;
                  $part.each(function () { if ($(this).prop("checked")) participation++; });

                  $row.find(".abs").text(absences);
                  $row.find(".par").text(participation);

                  $row.removeClass("highlight-green highlight-yellow highlight-red");
                  if (absences < 3) $row.addClass("highlight-green");
                  else if (absences <= 4) $row.addClass("highlight-yellow");
                  else $row.addClass("highlight-red");

                  const $msg = $row.find(".msgcol");
                  let message = "";
                  if (absences >= 5)
                      message = "Excluded — too many absences — You need to participate more";
                  else if (absences >= 3) {
                      if (participation >= 3) message = "Warning — attendance low — Participation OK";
                      else message = "Warning — attendance low — You need to participate more";
                  } else {
                      if (participation >= 3) message = "Good attendance — Excellent participation";
                      else message = "Good attendance — You should participate more";
                  }
                  $msg.text(message);
              }


              function updateAll() {
                  $tbody.find("tr").each(function () {
                      updateRow($(this));
                  });
              }


              $tbody.on("change", ".sess, .part", function () {
                  updateAll();
              });

              updateAll();

              // --- Ex6: Highlight Excellent Students ---
              $("#excellentBtn").click(function () {
                  $tbody.find("tr").each(function () {
                      const $row = $(this);
                      const absences = $row.find(".sess").filter(function () { return !$(this).prop("checked"); }).length;
                      if (absences < 3) {
                          $row.css("background", "#b6ffb6").fadeOut(200).fadeIn(200);
                      }
                  });
              });

              $("#resetBtn").click(function () {
                  $tbody.find("tr").each(function () {
                      $(this).css("background", "");
                      $(this).stop(true, true).fadeIn(0);
                  });
              });

              // --- Ex7: Search by Name ---
              $("#searchName").on("keyup", function () {
                  const val = $(this).val().toLowerCase();
                  $tbody.find("tr").each(function () {
                      const $row = $(this);
                      const last = $row.find("td").eq(1).text().toLowerCase();
                      const first = $row.find("td").eq(2).text().toLowerCase();
                      $row.toggle(last.includes(val) || first.includes(val));
                  });
              });

              // --- Ex7: Sort by Absences Ascending ---
              $("#sortAbs").click(function () {
                  const rows = $tbody.find("tr").get();
                  rows.sort(function (a, b) {
                      const aAbs = $(a).find(".sess").filter(function () { return !$(this).prop("checked"); }).length;
                      const bAbs = $(b).find(".sess").filter(function () { return !$(this).prop("checked"); }).length;
                      return aAbs - bAbs;
                  });
                  $.each(rows, function (i, row) { $tbody.append(row); });
                  $("#sortStatus").text("Currently sorted by absences (ascending)");
              });

              // --- Ex7: Sort by Participation Descending ---
              $("#sortPart").click(function () {
                  const rows = $tbody.find("tr").get();
                  rows.sort(function (a, b) {
                      const aPart = $(a).find(".part").filter(function () { return $(this).prop("checked"); }).length;
                      const bPart = $(b).find(".part").filter(function () { return $(this).prop("checked"); }).length;
                      return bPart - aPart;
                  });
                  $.each(rows, function (i, row) { $tbody.append(row); });
                  $("#sortStatus").text("Currently sorted by participation (descending)");
              });

          });
      </script>
     
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

     
      <script>
          $(document).ready(function () {

              $("tr").hover(
                  function () { $(this).css("background", "#d9edf7"); },
                  function () { $(this).css("background", ""); }
              );

              $("tr").click(function () {
                  let name = $(this).children().eq(0).text() + " " + $(this).children().eq(1).text();
                  let absCount = 0;

                  $(this).children().slice(2, 8).each(function () {
                      if ($(this).text() !== "✓") absCount++;
                  });

                  alert("Student: " + name + "\nAbsences: " + absCount);
              });

          });
      </script>

      <button id="excellentBtn">Highlight Excellent Students</button>
      <button id="resetBtn">Reset Colors</button>

      <script>
          $("#excellentBtn").click(function () {
              $("#attendanceTable tr").each(function () {
                  let abs = 0;

                  $(this).children().slice(2, 8).each(function () {
                      if ($(this).text() !== "✓") abs++;
                  });

                  if (abs < 3) {
                      $(this).animate({ opacity: 0.3 }, 300).animate({ opacity: 1 }, 300);
                      $(this).css("background", "#b6ffb6");
                  }
              });
          });

          $("#resetBtn").click(function () {
              $("#attendanceTable tr").css({ background: "", opacity: "1" });
          });
      </script>

  </body>
</html>
